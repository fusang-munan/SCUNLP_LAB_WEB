# 项目架构详解

本文档详细说明SCUNLP_LAB_WEB项目的具体实现，包括目录结构、渲染链路、模板继承关系等。

## 目录结构

```
SCUNLP_LAB_WEB/
├── config/_default/           # 配置目录
│   ├── hugo.yaml              # Hugo主配置
│   ├── params.yaml            # 站点参数
│   ├── module.yaml            # Hugo模块依赖
│   ├── languages.yaml         # 多语言配置
│   ├── menus.zh.yaml          # 中文菜单
│   └── menus.en.yaml          # 英文菜单
├── content/                   # 内容目录
│   ├── zh/                    # 中文内容
│   │   ├── _index.md          # 首页
│   │   ├── people/            # 人员介绍
│   │   ├── achievement/       # 成果展示（非论文类成果）
│   │   ├── publication/       # 论文库
│   │   ├── announcement/      # 公告
│   │   ├── authors/           # 作者信息
│   │   ├── contact/           # 联系方式
│   │   ├── project/           # 项目展示
│   │   ├── post/              # 博客/新闻
│   │   ├── event/             # 学术活动
│   │   └── admin/             # CMS后台
│   └── en/                    # 英文内容（结构同上，内容已翻译）
├── layouts/                   # 自定义模板
│   ├── achievement/           # 成果页模板
│   ├── announcement/          # 公告页模板
│   ├── publication/           # 论文页模板
│   └── partials/              # 可复用片段
│       ├── blocks/            # Block覆盖
│       ├── page_header.html
│       ├── page_metadata_authors.html
│       ├── site_footer.html
│       └── site_footer_license.html
├── assets/scss/               # 自定义样式
│   ├── custom.scss            # 主样式文件
│   ├── template.scss          # 模板样式
│   └── contact.scss           # 联系页样式
├── data/                      # 数据文件
│   ├── themes/scu.toml        # 主题配色
│   └── decap_cms_config.yaml  # CMS配置
├── i18n/                      # 国际化
│   ├── zh.yaml
│   └── en.yaml
├── static/                    # 静态资源
│   ├── admin/                 # CMS后台页面
│   ├── js/                    # JavaScript
│   └── uploads/               # 上传目录
└── site/                      # 参考资料（如bib文件）
```

## 页面与渲染链路

### 首页

**文件：** `content/zh/_index.md`

**渲染链路：**
```
content/zh/_index.md (type: landing)
    ↓
Hugo Blox 内置 landing 模板
    ↓
遍历 sections 数组，依次渲染每个 Block
    ↓
生成 /zh/index.html
```

**首页Section配置：**
```yaml
sections:
  - block: markdown      # 背景图区域
  - block: hero          # 实验室介绍
  - block: collection    # 动态与公告
  - block: collection    # 论文列表
  - block: markdown      # CTA按钮（跳转团队页）
```

### 成果展示页（Achievement）

**文件结构：**
```
content/zh/achievement/
├── _index.md            # 列表页配置（type: landing）
└── <成果内容>/          # 非论文类成果（如获奖、专利等）
    ├── index.md
    └── featured.jpg
```

**配置说明：**
- `achievement/_index.md` 配置为 `type: landing`，使用 collection block
- 从 `achievement` 自身目录读取内容（不再从 `publication` 读取）
- 与 `publication` 分开：`publication` 用于论文，`achievement` 用于其他成果

**渲染链路：**
```
访问 /zh/achievement/
    ↓
content/zh/achievement/_index.md (type: landing)
    ↓
collection block 从 achievement 目录读取
    ↓
layouts/achievement/section.html（自定义，如存在）
    ↓
渲染成果列表
```

**注意：** achievement 和 publication 是两个独立的 section，分别用于不同类型的成果展示。

### 人员介绍页（People）

**文件：** `content/zh/people/index.md`

**渲染链路：**
```
content/zh/people/index.md (block: people)
    ↓
layouts/partials/blocks/people.html（自定义覆盖）
    ↓
读取 content/zh/authors/ 下的作者数据
    ↓
按 user_groups 分组渲染
```

**作者数据来源：**
```
content/zh/authors/
├── wenqiang-lei/        # 使用连字符命名（推荐）
│   ├── _index.md        # 作者信息
│   └── avatar.jpg       # 头像
├── hongru-liang/
│   └── ...
└── admin/               # 模板默认用户（可选保留）
    └── ...
```

**命名规范：**
- 推荐使用小写+连字符格式（如 `wenqiang-lei`）
- 避免使用空格（会导致URL中出现 `%20`）
- 文件夹名应与作者 Front Matter 中的 `authors` 字段匹配

**分组逻辑：**
作者通过 `user_groups` 字段分组：
```yaml
# 作者 _index.md
user_groups:
  - 导师团队    # 或 "博士生"、"硕士生" 等
```

### 公告页（Announcement）

**文件结构：**
```
content/zh/announcement/
├── _index.md            # 列表页
├── announcement-1/
│   ├── index.md
│   └── images/          # 公告图片
├── announcement-2/
│   └── index.md
```

**渲染链路：**
```
访问 /zh/announcement/
    ↓
layouts/announcement/section.html
    ↓
按日期降序渲染公告列表

访问 /zh/announcement/announcement-1/
    ↓
layouts/announcement/single.html
    ↓
渲染公告详情
```

### 论文页（Publication）

**文件结构：**
```
content/zh/publication/
├── _index.md            # 列表页
├── paper-slug-1/
│   ├── index.md         # 论文信息
│   └── cite.bib         # 可选：引用文件
├── paper-slug-2/
│   └── index.md
```

**论文Front Matter示例：**
```yaml
---
title: "论文标题"
authors:
  - Wenqiang Lei
  - San Zhang
date: '2024-01-15'
publication: "ACL 2024, Bangkok, Thailand"
publication_types:
  - paper-conference
abstract: "摘要内容..."
url_pdf: "https://..."
url_code: "https://github.com/..."
tags:
  - NLP
  - LLM
---
```

**渲染链路：**
```
访问 /zh/publication/
    ↓
layouts/publication/section.html（自定义）
    ↓
渲染论文列表（含年份过滤器）

访问 /zh/publication/paper-slug-1/
    ↓
layouts/publication/single.html（自定义）
    ↓
渲染论文详情（标题、作者、摘要、链接等）
```

### 联系页（Contact）

**文件：** `content/zh/contact/index.md`

**渲染链路：**
```
content/zh/contact/index.md (type: landing)
    ↓
sections 数组包含 markdown block 和 contact block
    ↓
layouts/partials/blocks/contact.html（自定义覆盖）
    ↓
渲染联系信息和表单
```

**配置说明：**
- 使用 `css_style: 'contact.scss'` 加载特定样式（注意拼写，不是 `css_sytle`）

### 项目页（Project）

**文件：** `content/zh/project/_index.md`

**配置说明：**
- `type: landing`，使用 collection block
- 从 `project` 自身目录读取内容
- 用于展示实验室的研究项目

**渲染链路：**
```
访问 /zh/project/
    ↓
content/zh/project/_index.md (type: landing)
    ↓
collection block 从 project 目录读取
    ↓
渲染项目列表
```

## 模板继承关系

```
Hugo Blox 默认模板
    │
    ├── baseof.html                    # 页面骨架
    │       ↓
    ├── layouts/xxx/section.html       # Section列表
    │       ↓
    ├── layouts/xxx/single.html        # 单页内容
    │       ↓
    └── layouts/partials/...           # 可复用片段

项目自定义模板（覆盖默认）
    │
    ├── layouts/achievement/section.html  ← 自定义年份分组
    ├── layouts/achievement/single.html
    ├── layouts/announcement/section.html
    ├── layouts/announcement/single.html
    ├── layouts/publication/section.html  ← 自定义过滤器
    ├── layouts/publication/single.html   ← 自定义详情布局
    │
    └── layouts/partials/
            ├── blocks/people.html        ← 覆盖人员卡片
            ├── blocks/contact.html       ← 覆盖联系表单
            ├── page_header.html          ← 页面标题区
            ├── page_metadata_authors.html ← 作者列表格式
            ├── site_footer.html          ← 页脚
            └── site_footer_license.html  ← 版权信息
```

**覆盖优先级：**
```
layouts/xxx/xxx.html（项目）
    > themes/hugo-blox/layouts/xxx/xxx.html（主题）
    > layouts/_default/xxx.html（默认）
```

## 配置文件详解

### hugo.yaml

```yaml
title: 四川大学自然语言处理实验室    # 站点标题
baseURL: 'http://106.55.103.208:1313/'  # 站点URL（开发环境，生产环境应使用实际域名）

defaultContentLanguage: zh       # 默认语言
hasCJKLanguage: true             # CJK语言处理（必须为true以支持中文）
pagination:
  pagerSize: 10                 # 每页条数

taxonomies:                     # 分类法定义
  tag: tags
  category: categories
  author: authors
  publication_type: publication_types

permalinks:                     # URL格式
  authors: '/author/:slug/'
  tags: '/tag/:slug/'
```

### params.yaml

```yaml
appearance:
  theme_day: scu               # 日间主题
  theme_night: scu             # 夜间主题
  font: native                 # 字体（native使用系统字体）
  font_size: L                 # 字体大小

marketing:
  seo:
    site_type: Organization
    org_name: '四川大学自然语言处理实验室'  # 组织名称
    description: '四川大学自然语言处理实验室（SCUNLP Lab）专注于...'  # SEO描述

header:
  navbar:
    enable: true
    align: r                   # 菜单靠右
    show_logo: true
    show_language: false       # 不显示语言切换
    show_day_night: true       # 显示日夜切换
    show_search: true

footer:
  copyright:
    notice: '<p>{team} © {year}...</p>'

features:
  repository:
    url: ''                    # 仓库地址（已清理占位符）
  search:
    provider: wowchemy         # 搜索提供者
  avatar:
    shape: circle              # 头像形状

publications:
  date_format: January 2006    # 论文日期格式
  citation_style: apa          # 引用格式
```

### menus.zh.yaml

```yaml
main:
  - name: 成果展示
    url: achievement
    weight: 30
  - name: 人员介绍
    url: people
    weight: 40
  - name: 公告
    url: announcement
    weight: 50
  - name: 联系方式
    url: contact
    weight: 70
```

**注意：**
- `weight` 决定菜单顺序，数字越小越靠前
- `url` 可以使用相对路径（如 `achievement`）或绝对路径（如 `/achievement/`）
- `publication` 在菜单中被注释，因为 `achievement` 作为成果展示入口

## 数据流

### 论文作者高亮

**流程：**
```
论文 index.md 的 authors 字段
    ↓
与 content/zh/authors/ 目录匹配
    ↓
匹配成功 → 显示链接，跳转作者页
匹配失败 → 仅显示文字
```

**实现位置：** `layouts/partials/page_metadata_authors.html`

### 首页论文聚合

**流程：**
```
content/zh/_index.md 的 collection block
    ↓
配置 filters.folders: [publication]
    ↓
Hugo 查询 content/zh/publication/ 下所有页面
    ↓
按 date 降序，取前 count 条
    ↓
使用 view: citation 渲染
```

### Achievement 数据读取

**流程：**
```
content/zh/achievement/_index.md (type: landing)
    ↓
collection block 配置 filters.folders: [achievement]
    ↓
Hugo 查询 content/zh/achievement/ 下所有页面（排除 _index.md）
    ↓
按配置的排序规则渲染
    ↓
使用 view: citation 或其他视图渲染
```

**注意：** achievement 现在从自身目录读取，不再从 publication 读取。

## 样式管理

### SCSS文件加载顺序

```
Hugo Blox 默认样式
    ↓
assets/scss/template.scss     # 项目模板样式
    ↓
assets/scss/custom.scss       # 项目自定义样式
    ↓
assets/scss/contact.scss      # 特定页面样式
```

### 主题色应用

```
data/themes/scu.toml          # 定义颜色变量
    ↓
params.yaml appearance.theme_day: scu
    ↓
Hugo Blox 读取主题文件
    ↓
注入为CSS变量
    ↓
样式中使用 var(--color-primary) 等
```

## 构建输出

执行 `hugo` 后生成 `public/` 目录：

```
public/
├── zh/
│   ├── index.html           # 中文首页
│   ├── achievement/
│   │   └── index.html       # 成果列表（从achievement目录读取）
│   ├── publication/
│   │   ├── index.html       # 论文列表
│   │   └── <论文slug>/index.html
│   ├── announcement/
│   │   ├── index.html
│   │   └── announcement-*/index.html
│   ├── project/
│   │   └── index.html       # 项目列表
│   ├── people/
│   │   └── index.html
│   ├── contact/
│   │   └── index.html
│   ├── post/
│   │   └── index.html
│   ├── event/
│   │   └── index.html
│   └── authors/
│       ├── wenqiang-lei/index.html
│       └── hongru-liang/index.html
├── en/
│   └── ...                  # 英文内容（结构相同，内容已翻译）
├── css/
├── js/
├── media/                   # 图片资源
├── index.html               # 根路径重定向
├── sitemap.xml
└── robots.txt
```

## 重要配置说明

### 多语言支持

- `hasCJKLanguage: true` 必须设置，以支持中文内容处理
- 中英文内容分别在 `content/zh/` 和 `content/en/` 目录
- 英文版内容已翻译完成，保持与中文版同步

### 已清理的内容

以下内容已从项目中删除（模板示例和占位符）：
- `tour/` - 模板演示页
- `post/20-12-*` - 示例新闻
- `event/example/` - 示例活动
- `achievement/example/` - 错误示例
- 占位符作者（San Zhang、Si Li、Wu Wang）

### 保留的模板示例

以下内容保留作为参考模板：
- `publication/conference-paper/` - 会议论文模板
- `publication/journal-article/` - 期刊论文模板
- `publication/preprint/` - 预印本模板

### 常见问题

1. **CSS样式不生效**：检查 `css_style` 拼写（不是 `css_sytle`）
2. **中文显示异常**：确保 `hasCJKLanguage: true`
3. **作者链接失效**：检查作者文件夹名与 `authors` 字段是否匹配
4. **菜单不显示**：检查 `menus.zh.yaml` 和 `menus.en.yaml` 配置

## 下一步

- 需要修改页面结构 → [04-模板与布局定制](./04-模板与布局定制.md)
- 需要修改视觉样式 → [05-样式与主题定制](./05-样式与主题定制.md)
- 查看问题诊断 → [06-项目问题诊断与改进计划](./06-项目问题诊断与改进计划.md)
